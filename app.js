var web3;
if (typeof window.web3 !== "undefined" && typeof window.web3.currentProvider !== "undefined") {
    web3 = new Web3(window.web3.currentProvider);
}

console.log(web3);

var abiJSON = [ { "constant": true, "inputs": [ { "name": "", "type": "uint256" } ], "name": "owners", "outputs": [ { "name": "", "type": "address" } ], "payable": false, "type": "function", "stateMutability": "view" }, { "constant": false, "inputs": [ { "name": "owner", "type": "address" } ], "name": "removeOwner", "outputs": [], "payable": false, "type": "function", "stateMutability": "nonpayable" }, { "constant": false, "inputs": [ { "name": "transactionId", "type": "uint256" } ], "name": "revokeConfirmation", "outputs": [], "payable": false, "type": "function", "stateMutability": "nonpayable" }, { "constant": true, "inputs": [ { "name": "", "type": "address" } ], "name": "isOwner", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "type": "function", "stateMutability": "view" }, { "constant": true, "inputs": [ { "name": "", "type": "uint256" }, { "name": "", "type": "address" } ], "name": "confirmations", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "type": "function", "stateMutability": "view" }, { "constant": false, "inputs": [ { "name": "destination", "type": "address" }, { "name": "send_to", "type": "address" }, { "name": "value", "type": "uint256" }, { "name": "data", "type": "bytes" } ], "name": "submitTransaction", "outputs": [ { "name": "transactionId", "type": "uint256" } ], "payable": false, "type": "function", "stateMutability": "nonpayable" }, { "constant": true, "inputs": [ { "name": "pending", "type": "bool" }, { "name": "executed", "type": "bool" } ], "name": "getTransactionCount", "outputs": [ { "name": "count", "type": "uint256" } ], "payable": false, "type": "function", "stateMutability": "view" }, { "constant": false, "inputs": [ { "name": "owner", "type": "address" } ], "name": "addOwner", "outputs": [], "payable": false, "type": "function", "stateMutability": "nonpayable" }, { "constant": true, "inputs": [ { "name": "transactionId", "type": "uint256" } ], "name": "isConfirmed", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "type": "function", "stateMutability": "view" }, { "constant": true, "inputs": [ { "name": "transactionId", "type": "uint256" } ], "name": "getConfirmationCount", "outputs": [ { "name": "count", "type": "uint256" } ], "payable": false, "type": "function", "stateMutability": "view" }, { "constant": true, "inputs": [ { "name": "", "type": "uint256" } ], "name": "transactions", "outputs": [ { "name": "destination", "type": "address" }, { "name": "send_to", "type": "address" }, { "name": "value", "type": "uint256" }, { "name": "data", "type": "bytes" }, { "name": "executed", "type": "bool" } ], "payable": false, "type": "function", "stateMutability": "view" }, { "constant": true, "inputs": [], "name": "getOwners", "outputs": [ { "name": "", "type": "address[]" } ], "payable": false, "type": "function", "stateMutability": "view" }, { "constant": true, "inputs": [ { "name": "from", "type": "uint256" }, { "name": "to", "type": "uint256" }, { "name": "pending", "type": "bool" }, { "name": "executed", "type": "bool" } ], "name": "getTransactionIds", "outputs": [ { "name": "_transactionIds", "type": "uint256[]" } ], "payable": false, "type": "function", "stateMutability": "view" }, { "constant": true, "inputs": [ { "name": "transactionId", "type": "uint256" } ], "name": "getConfirmations", "outputs": [ { "name": "_confirmations", "type": "address[]" } ], "payable": false, "type": "function", "stateMutability": "view" }, { "constant": true, "inputs": [], "name": "transactionCount", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function", "stateMutability": "view" }, { "constant": false, "inputs": [ { "name": "_required", "type": "uint256" } ], "name": "changeRequirement", "outputs": [], "payable": false, "type": "function", "stateMutability": "nonpayable" }, { "constant": false, "inputs": [ { "name": "transactionId", "type": "uint256" } ], "name": "confirmTransaction", "outputs": [], "payable": false, "type": "function", "stateMutability": "nonpayable" }, { "constant": true, "inputs": [], "name": "MAX_OWNER_COUNT", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function", "stateMutability": "view" }, { "constant": true, "inputs": [], "name": "required", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function", "stateMutability": "view" }, { "constant": false, "inputs": [ { "name": "owner", "type": "address" }, { "name": "newOwner", "type": "address" } ], "name": "replaceOwner", "outputs": [], "payable": false, "type": "function", "stateMutability": "nonpayable" }, { "constant": false, "inputs": [ { "name": "transactionId", "type": "uint256" } ], "name": "executeTransaction", "outputs": [], "payable": false, "type": "function", "stateMutability": "nonpayable" }, { "inputs": [ { "name": "_owners", "type": "address[]" }, { "name": "_required", "type": "uint256" } ], "payable": false, "type": "constructor", "stateMutability": "nonpayable" }, { "payable": true, "type": "fallback", "stateMutability": "payable" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "sender", "type": "address" }, { "indexed": true, "name": "transactionId", "type": "uint256" } ], "name": "Confirmation", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "sender", "type": "address" }, { "indexed": true, "name": "transactionId", "type": "uint256" } ], "name": "Revocation", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "transactionId", "type": "uint256" } ], "name": "Submission", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "transactionId", "type": "uint256" } ], "name": "Execution", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "transactionId", "type": "uint256" } ], "name": "ExecutionFailure", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "sender", "type": "address" }, { "indexed": false, "name": "value", "type": "uint256" } ], "name": "Deposit", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "owner", "type": "address" } ], "name": "OwnerAddition", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "owner", "type": "address" } ], "name": "OwnerRemoval", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": false, "name": "required", "type": "uint256" } ], "name": "RequirementChange", "type": "event" } ];
var byteCode = "606060405234156200001057600080fd5b6040516200196538038062001965833981016040528080518201919060200180519150505b6000825182603282111580156200004c5750818111155b80156200005857508015155b80156200006457508115155b15156200007057600080fd5b600092505b84518310156200014157600260008685815181106200009057fe5b90602001906020020151600160a060020a0316815260208101919091526040016000205460ff16158015620000e35750848381518110620000cd57fe5b90602001906020020151600160a060020a031615155b1515620000ef57600080fd5b6001600260008786815181106200010257fe5b90602001906020020151600160a060020a031681526020810191909152604001600020805460ff19169115159190911790555b60019092019162000075565b60038580516200015692916020019062000169565b5060048490555b5b505050505062000204565b828054828255906000526020600020908101928215620001c3579160200282015b82811115620001c35782518254600160a060020a031916600160a060020a0391909116178255602092909201916001909101906200018a565b5b50620001d2929150620001d6565b5090565b6200020191905b80821115620001d2578054600160a060020a0319168155600101620001dd565b5090565b90565b61175180620002146000396000f3006060604052361561011a5763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663025e7c278114610165578063173825d91461019757806320ea8d86146101b85780632f54bf6e146101d05780633411c81c1461020357806343319cf01461023957806354741525146102b75780637065cb48146102e6578063784547a7146103075780638b51d13f146103315780639ace38c214610359578063a0e67e2b14610421578063a8abe69a14610488578063b5dc40c3146104ff578063b77bf60014610569578063ba51a6df1461058e578063c01a8c84146105a6578063d74f8edd146105be578063dc8452cd146105e3578063e20056e614610608578063ee22610b1461062f575b5b60003411156101625733600160a060020a03167fe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c3460405190815260200160405180910390a25b5b005b341561017057600080fd5b61017b600435610647565b604051600160a060020a03909116815260200160405180910390f35b34156101a257600080fd5b610162600160a060020a0360043516610679565b005b34156101c357600080fd5b61016260043561082a565b005b34156101db57600080fd5b6101ef600160a060020a036004351661090c565b604051901515815260200160405180910390f35b341561020e57600080fd5b6101ef600435600160a060020a0360243516610921565b604051901515815260200160405180910390f35b341561024457600080fd5b6102a5600160a060020a036004803582169160248035909116916044359160849060643590810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284375094965061094195505050505050565b60405190815260200160405180910390f35b34156102c257600080fd5b6102a560043515156024351515610963565b60405190815260200160405180910390f35b34156102f157600080fd5b610162600160a060020a03600435166109d2565b005b341561031257600080fd5b6101ef600435610b0f565b604051901515815260200160405180910390f35b341561033c57600080fd5b6102a5600435610ba3565b60405190815260200160405180910390f35b341561036457600080fd5b61036f600435610c22565b604051600160a060020a0380871682528516602082015260408101849052811515608082015260a0606082018181528454600260001961010060018416150201909116049183018290529060c08301908590801561040e5780601f106103e35761010080835404028352916020019161040e565b820191906000526020600020905b8154815290600101906020018083116103f157829003601f168201915b5050965050505050505060405180910390f35b341561042c57600080fd5b610434610c5e565b60405160208082528190810183818151815260200191508051906020019060200280838360005b838110156104745780820151818401525b60200161045b565b505050509050019250505060405180910390f35b341561049357600080fd5b61043460043560243560443515156064351515610cc7565b60405160208082528190810183818151815260200191508051906020019060200280838360005b838110156104745780820151818401525b60200161045b565b505050509050019250505060405180910390f35b341561050a57600080fd5b610434600435610df5565b60405160208082528190810183818151815260200191508051906020019060200280838360005b838110156104745780820151818401525b60200161045b565b505050509050019250505060405180910390f35b341561057457600080fd5b6102a5610f77565b60405190815260200160405180910390f35b341561059957600080fd5b610162600435610f7d565b005b34156105b157600080fd5b610162600435611013565b005b34156105c957600080fd5b6102a561112c565b60405190815260200160405180910390f35b34156105ee57600080fd5b6102a5611131565b60405190815260200160405180910390f35b341561061357600080fd5b610162600160a060020a0360043581169060243516611137565b005b341561063a57600080fd5b6101626004356112f8565b005b600380548290811061065557fe5b906000526020600020900160005b915054906101000a9004600160a060020a031681565b600030600160a060020a031633600160a060020a031614151561069b57600080fd5b600160a060020a038216600090815260026020526040902054829060ff1615156106c457600080fd5b600160a060020a0383166000908152600260205260408120805460ff1916905591505b600354600019018210156107bf5782600160a060020a031660038381548110151561070e57fe5b906000526020600020900160005b9054906101000a9004600160a060020a0316600160a060020a031614156107b35760038054600019810190811061074f57fe5b906000526020600020900160005b9054906101000a9004600160a060020a031660038381548110151561077e57fe5b906000526020600020900160005b6101000a815481600160a060020a030219169083600160a060020a031602179055506107bf565b5b6001909101906106e7565b6003805460001901906107d2908261160d565b5060035460045411156107eb576003546107eb90610f7d565b5b82600160a060020a03167f8001553a916ef2f495d26a907cc54d96ed840d7bda71e73194bf5a9df7a76b9060405160405180910390a25b5b505b5050565b33600160a060020a03811660009081526002602052604090205460ff16151561085257600080fd5b600082815260016020908152604080832033600160a060020a038116855292529091205483919060ff16151561088757600080fd5b600084815260208190526040902060040154849060ff16156108a857600080fd5b6000858152600160209081526040808320600160a060020a033316808552925291829020805460ff1916905586917ff6a317157440607f36269043eb55f1287a5a19ba2216afeab88cd46cbcfb88e9905160405180910390a35b5b505b50505b5050565b60026020526000908152604090205460ff1681565b600160209081526000928352604080842090915290825290205460ff1681565b600061094f858585856114ce565b905061095a81611013565b5b949350505050565b6000805b6005548110156109ca57838015610990575060008181526020819052604090206004015460ff16155b806109b457508280156109b4575060008181526020819052604090206004015460ff165b5b156109c1576001820191505b5b600101610967565b5b5092915050565b30600160a060020a031633600160a060020a03161415156109f257600080fd5b600160a060020a038116600090815260026020526040902054819060ff1615610a1a57600080fd5b81600160a060020a0381161515610a3057600080fd5b60038054905060010160045460328211158015610a4d5750818111155b8015610a5857508015155b8015610a6357508115155b1515610a6e57600080fd5b600160a060020a0385166000908152600260205260409020805460ff191660019081179091556003805490918101610aa6838261160d565b916000526020600020900160005b8154600160a060020a03808a166101009390930a8381029102199091161790915590507ff39e6e1eb0edcf53c221607b54b00cd28f3196fed0a24994dc308b8f611b682d60405160405180910390a25b5b50505b505b505b50565b600080805b600354811015610b9b5760008481526001602052604081206003805491929184908110610b3d57fe5b906000526020600020900160005b9054600160a060020a036101009290920a900416815260208101919091526040016000205460ff1615610b7f576001820191505b600454821415610b925760019250610b9b565b5b600101610b14565b5b5050919050565b6000805b600354811015610c1b5760008381526001602052604081206003805491929184908110610bd057fe5b906000526020600020900160005b9054600160a060020a036101009290920a900416815260208101919091526040016000205460ff1615610c12576001820191505b5b600101610ba7565b5b50919050565b60006020819052908152604090208054600182015460028301546004840154600160a060020a0393841694929093169290916003019060ff1685565b610c66611661565b6003805480602002602001604051908101604052809291908181526020018280548015610cbc57602002820191906000526020600020905b8154600160a060020a03168152600190910190602001808311610c9e575b505050505090505b90565b610ccf611661565b610cd7611661565b600080600554604051805910610cea5750595b908082528060200260200182016040525b50925060009150600090505b600554811015610d8257858015610d30575060008181526020819052604090206004015460ff16155b80610d545750848015610d54575060008181526020819052604090206004015460ff165b5b15610d795780838381518110610d6757fe5b60209081029091010152600191909101905b5b600101610d07565b878703604051805910610d925750595b908082528060200260200182016040525b5093508790505b86811015610de957828181518110610dbe57fe5b906020019060200201518489830381518110610dd657fe5b602090810290910101525b600101610daa565b5b505050949350505050565b610dfd611661565b610e05611661565b6003546000908190604051805910610e1a5750595b908082528060200260200182016040525b50925060009150600090505b600354811015610efd5760008581526001602052604081206003805491929184908110610e6057fe5b906000526020600020900160005b9054600160a060020a036101009290920a900416815260208101919091526040016000205460ff1615610ef4576003805482908110610ea957fe5b906000526020600020900160005b9054906101000a9004600160a060020a0316838381518110610ed557fe5b600160a060020a03909216602092830290910190910152600191909101905b5b600101610e37565b81604051805910610f0b5750595b908082528060200260200182016040525b509350600090505b81811015610f6e57828181518110610f3857fe5b90602001906020020151848281518110610f4e57fe5b600160a060020a039092166020928302909101909101525b600101610f24565b5b505050919050565b60055481565b30600160a060020a031633600160a060020a0316141515610f9d57600080fd5b6003548160328211801590610fb25750818111155b8015610fbd57508015155b8015610fc857508115155b1515610fd357600080fd5b60048390557fa3f1ee9126a074d9326c682f561767f710e927faa811f7a99829d49dc421797a8360405190815260200160405180910390a15b5b50505b50565b33600160a060020a03811660009081526002602052604090205460ff16151561103b57600080fd5b6000828152602081905260409020548290600160a060020a03161580159061107c5750600081815260208190526040902060010154600160a060020a031615155b151561108757600080fd5b600083815260016020908152604080832033600160a060020a038116855292529091205484919060ff16156110bb57600080fd5b6000858152600160208181526040808420600160a060020a033316808652925292839020805460ff191690921790915586917f4a504a94899432a9846e1aa406dceb1bcfd538bb839071d49d1e5e23f5be30ef905160405180910390a3610902856112f8565b5b5b50505b505b5050565b603281565b60045481565b600030600160a060020a031633600160a060020a031614151561115957600080fd5b600160a060020a038316600090815260026020526040902054839060ff16151561118257600080fd5b600160a060020a038316600090815260026020526040902054839060ff16156111aa57600080fd5b600092505b6003548310156112525784600160a060020a03166003848154811015156111d257fe5b906000526020600020900160005b9054906101000a9004600160a060020a0316600160a060020a03161415611246578360038481548110151561121157fe5b906000526020600020900160005b6101000a815481600160a060020a030219169083600160a060020a03160217905550611252565b5b6001909201916111af565b600160a060020a03808616600081815260026020526040808220805460ff199081169091559388168252908190208054909316600117909255907f8001553a916ef2f495d26a907cc54d96ed840d7bda71e73194bf5a9df7a76b90905160405180910390a283600160a060020a03167ff39e6e1eb0edcf53c221607b54b00cd28f3196fed0a24994dc308b8f611b682d60405160405180910390a25b5b505b505b505050565b33600160a060020a0381166000908152600260205260408120549091829160ff16151561132457600080fd5b600084815260016020908152604080832033600160a060020a038116855292529091205485919060ff16151561135957600080fd5b600086815260208190526040902060040154869060ff161561137a57600080fd5b61138387610b0f565b156114c05760008781526020819052604080822060048101805460ff191660019081179091558154908201546002830154929a50600160a060020a039182169950899463a9059cbb949190921692919051602001526040517c010000000000000000000000000000000000000000000000000000000063ffffffff8516028152600160a060020a0390921660048301526024820152604401602060405180830381600087803b151561143457600080fd5b6102c65a03f1151561144557600080fd5b505050604051805190501561148657867f33e13ecb54c3076d8e8bb8c2881800a4d972b792045ffae98fdf46df365fed7560405160405180910390a26114c0565b867f526441bb6c1aba3c9a4a6ca1d6545da9c2333c8c48343ef398eb858d72b7923660405160405180910390a260048601805460ff191690555b5b5b5b505b50505b50505050565b600084600160a060020a03811615156114e657600080fd5b600554915060a06040519081016040908152600160a060020a03808916835287166020808401919091528183018790526060830186905260006080840181905285815290819052208151815473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0391909116178155602082015160018201805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0392909216919091179055604082015181600201556060820151816003019080516115b0929160200190611685565b506080820151600491909101805460ff191691151591909117905550600580546001019055817fc0ba8fe4b176c1714197d43b9cc6bcf797a4a7461c5fe8d0ef6e184ae7601e5160405160405180910390a25b5b50949350505050565b81548183558181151161082357600083815260209020610823918101908301611704565b5b505050565b81548183558181151161082357600083815260209020610823918101908301611704565b5b505050565b60206040519081016040526000815290565b60206040519081016040526000815290565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106116c657805160ff19168380011785556116f3565b828001600101855582156116f3579182015b828111156116f35782518255916020019190600101906116d8565b5b50611700929150611704565b5090565b610cc491905b80821115611700576000815560010161170a565b5090565b905600a165627a7a72305820cb9ed7feaae194e1d9a8a364e796f75013cea9cbbd524c46430589ec038a5d0f0029";

var MyContract = web3.eth.contract(abiJSON);

function createContract() {

    var myAddress = web3.eth.accounts[0];
    var ca1 = document.getElementById('ca1').value;
    var ca2 = document.getElementById('ca2').value;

    if (!ca1 || !ca2) {
       alert("please enter at least 2 addresses");
       return;
    }
    // else{
    //   if(!isAddress(ca1)){
    //     alert('address one is invalid format');
    //     return;
    //   }
    //
    //   if(!isAddress(ca2)){
    //     alert('address second is invalid format');
    //     return;
    //   }
    // }

    if (!myAddress) {
        alert("unlock metamask!");
        return;
    }

    var owners = [myAddress, ca1, ca2];
    var req_signer= document.getElementById('req').value;

    MyContract.new(owners,req_signer, {
        from: myAddress,
        data: byteCode,
        gas: 4000000
    }, function (err, myContract) {
        console.log(err, myContract)
        if (!err) {
            // NOTE: The callback will fire twice!
            // Once the contract has the transactionHash property set and once its deployed on an address.
            // e.g. check tx hash on the first call (transaction send)
            if (!myContract.address) {
                console.log(myContract.transactionHash) // The hash of the transaction, which deploys the contract
                // check address on the second call (contract deployed)
            } else {
                document.getElementById('address').innerHTML = myContract.address;
                console.log(myContract.address) // the contract address
            }
        }
    });
}

function submitTransaction() {
      var ca = document.getElementById('st_ca').value;
      var da = document.getElementById('st_da').value;
      var atm = document.getElementById('st_atm').value;

      var myAddress = web3.eth.accounts[0];

      if (!ca || !da || !atm) {
         alert("please enter valid data!");
         return;
      }
      if (!myAddress) {
         alert("unlock the metamask");
         return;
      }

      document.getElementById('cst_info').innerHTML = "please wait for tx to confirm:";

      var _tokenContract = web3.eth.contract(abiJSON).at(ca);

      _tokenContract.submitTransaction.sendTransaction("0xaa6ffff26c5cd43a011385f1c94b95a17b678857",da, atm, "", {
          from: myAddress,
          gas: 400000
        }, function (err, result) {
          if (err != null) {
            alert(err);
	    } else {
	    var myEvent = _tokenContract.Submission({},{fromBlock: 0, toBlock: 'latest'});
	    myEvent.watch(function(error, result) {
		if (err) {
                   return;
                }
                var id = result.args.transactionId.c[0];
	        console.log(error, result);
	        document.getElementById('cst_info').innerHTML = "last submitted tx id is (it might take sometime to get latest submitted tx id please wait): " + id;
	    });
	    }
       });
}

function confirmTransaction() {
      var ct_ca = document.getElementById('ct_ca').value;
      var myAddress = web3.eth.accounts[0];
      var tID = document.getElementById('tID').value;

      if (!ct_ca || !tID) {
         alert("please enter valid data!");
         return;
      }
      if (!myAddress) {
         alert("unlock the metamask");
         return;
      }

      var _tokenContract = web3.eth.contract(abiJSON).at(ct_ca);
      _tokenContract.confirmTransaction.sendTransaction(tID, {
          from: myAddress,
          gas: 400000
        }, function (err, result) {
          if (err != null) {
            alert(err);
          } else {
          }
      });
}
// var accounts = new Accounts('ws://localhost:8546');
function createAccount() {
   var myAddress = web3.eth.accounts;
   console.log(myAddress,"-------")
   var defaultAccount = web3.eth.defaultAccount;
console.log(defaultAccount);
var balance = web3.eth.getBalance("0x4b7e34384b6656ccbb8a99594a599cf4dbe6350d",function(error, result){
    if(!error)
        console.log(JSON.stringify(result));
    else
        console.error(error);
});
var balance = web3.eth.accounts.sign("0x4b7e34384b6656ccbb8a99594a599cf4dbe6350d",function(error, result){
    if(!error)
        console.log(JSON.stringify(result));
    else
        console.error(error);
});
}
var isAddress = function (address) {
    if (!/^(0x)?[0-9a-f]{40}$/i.test(address)) {
        // check if it has the basic requirements of an address
        return false;
    } else if (/^(0x)?[0-9a-f]{40}$/.test(address) || /^(0x)?[0-9A-F]{40}$/.test(address)) {
        // If it's all small caps or all all caps, return true
        return true;
    } else {
        // Otherwise check each case
        return isChecksumAddress(address);
    }
};

/**
 * Checks if the given string is a checksummed address
 *
 * @method isChecksumAddress
 * @param {String} address the given HEX adress
 * @return {Boolean}
*/
var isChecksumAddress = function (address) {
    // Check each case
    address = address.replace('0x','');
    var addressHash = sha3(address.toLowerCase());
    for (var i = 0; i < 40; i++ ) {
        // the nth letter should be uppercase if the nth digit of casemap is 1
        if ((parseInt(addressHash[i], 16) > 7 && address[i].toUpperCase() !== address[i]) || (parseInt(addressHash[i], 16) <= 7 && address[i].toLowerCase() !== address[i])) {
            return false;
        }
    }
    return true;
};
